### Intorduction
现代密码学给出的密码安全的定义是“密码的安全性取决于密钥的安全性”，由此基于计算复杂性的数学难题
衍生了很多密码算法，如基于因数分解的RSA密码算法。

本文主要针对AES算法的能量分析攻击。

能量分析攻击首先是由Kocher在19XX提出来的，他提出密码设备比如智能卡、ASIC芯片、微处理器在
运行密码算法时，会泄露关于密钥运行的信息，比如：电压、电磁辐射、声音等。

能量分析攻击是密码侧信道分析的一种，密码侧信道分析有：计时分析、故障注入攻击、故障敏感性分析、
统计分析、代数攻击、能量分析攻击。能量分析攻击又有：SPA（简单能量分析）、DPA差分能量分析、模板攻击、
针对掩码的能量分析攻击等等。

### 攻击流程
这里的攻击方法采取的是DPA，DPA使用的是很多的能量曲线，也就是选择明文攻击，每一条能量曲线对应着一个明文，
每条曲线上有很多的采样点。

1. 能量轨迹的获取
2. 密钥信息的恢复
处理工具：matlab

我们的目的是为了恢复出密钥，能量轨迹中的k可能是密钥的一部分或者可能是经过计算K的得到的中间值，
我们得到的可控的数据：

第一个矩阵（向量）：明文d可控，d是一个列向量，长度是len(d),记为D，

第二个矩阵：len(d)*T，T是采样点数（能量轨迹的长度）

每一个明文d对应着矩阵T的一行（能量对齐问题？）

计算假设中间值，有了明文矩阵D，我们需要一个假设空间K，计算f(D,K)来生成假设模型V，
V的每一行是一个明文，不同密钥；每一列密钥相同，明文不同

D,K都算是已知，就可以求出能量中间值，但是对于中间值无法直接进行能量分析，所以要对能量值应用
能量模型（汉明重量模型），就是获取这个值的能量消耗值


### 比较两个能量轨迹
对于两个能量轨迹，用基于相关系数的方法，计算生成的H和真实的能量轨迹T
计算方法：
```
[d1,k] = size(H); % 假设能量模型,d:明文数，k:猜测密钥个数
[d2,t] = size(T); % d2:明文个数，d1和d2应该是相等的吧 t：采样点，能量轨迹的长度
% 这儿是用H的列与T的列计算相关性，第一个应该是密钥第一个与所有的采样点计算相关性，得到t个结果，最终得到的结果k*t的矩阵
for i = 1:k
   for j = 1:t
       ans = corrcoef(H(:i),T(:j)); 
       R(i,j) = ans(1,2);
   end
end
```

相关系数矩阵R，R的每一行代表着啥？真实密钥值和假设密钥之间的相关系数？取出最大的那条，就是我们要找的密钥值，对应的**时刻T**,
就是这一步中间函数执行的时刻，这个时刻T执行了和密钥相关的操作。

假设能量消耗值列hi和真实能量轨迹列tj的匹配度越高，就会出现R中的最大值，查找矩阵R中的最大值就可以确定出正确密钥的索引i和时刻j

**矩阵R中最大值的索引揭示了所选择中间值进行处理的位置（能量迹中的泄露点）以及设备所使用的密钥**

### 实际操作

[数据集](http://dpabook.iaik.tugraz.at/)
